<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relatório Mensal de Jovens</title>
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #eef2f7; padding: 15px; color: #333; }
        .form-card { max-width: 700px; margin: auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: #1a3a5a; border-bottom: 2px solid #1a3a5a; padding-bottom: 10px; }
        
        .section-title { background: #1a3a5a; color: white; padding: 8px 12px; border-radius: 5px; margin-top: 20px; font-weight: bold; }
        .row { display: flex; flex-wrap: wrap; gap: 15px; margin-top: 15px; }
        .field { flex: 1; min-width: 150px; display: flex; flex-direction: column; }
        
        input[type="text"], input[type="number"], select { padding: 10px; border: 1px solid #ccc; border-radius: 5px; font-size: 16px; }
        
        .grid-dados { display: grid; grid-template-columns: 4fr 1fr; gap: 10px; margin-top: 15px; align-items: center; }
        .grid-dados label { font-size: 0.9em; border-bottom: 1px dotted #ccc; padding-bottom: 5px; }

        .signature-area { margin-top: 30px; padding: 15px; border: 1px solid #ddd; border-radius: 8px; background: #fafafa; }
        canvas { width: 100%; height: 120px; border: 1px dashed #999; background: #fff; touch-action: none; }
        .timestamp { font-size: 0.75em; color: #d9534f; font-weight: bold; margin-bottom: 10px; }
        
        button.btn-main { width: 100%; padding: 15px; background: #28a745; color: white; border: none; border-radius: 8px; font-size: 1.1em; font-weight: bold; cursor: pointer; margin-top: 30px; }
        button.btn-clear { background: #6c757d; color: white; border: none; padding: 5px 10px; border-radius: 4px; font-size: 0.8em; cursor: pointer; }
    </style>
</head>
<body>

<div class="form-card">
    <h2>Relatório do Departamento de Jovens</h2>

    <div class="row">
        <div class="field">
            <label>CONGREGAÇÃO:</label>
            <input type="text" id="congregacao">
        </div>
        <div class="field">
            <label>GRUPO:</label>
            <input type="text" id="grupo">
        </div>
        <div class="field">
            <label>MÊS/ANO:</label>
            <input type="month" id="mes">
        </div>
    </div>

    <div class="section-title">DADOS / QTDE.</div>
    <div class="grid-dados">
        <label>Decisões de Jovens:</label><input type="number" id="d1">
        <label>Reconciliações de Jovens:</label><input type="number" id="d2">
        <label>Cultos Evangelísticos na Rua:</label><input type="number" id="d3">
        <label>Cultos Dirigidos na Congregação:</label><input type="number" id="d4">
        <label>Círculo de Oração Jovem (COJ):</label><input type="number" id="d5">
        <label>Visita aos Lares (Núcleo):</label><input type="number" id="d6">
        <label>Batismo com Espírito Santo:</label><input type="number" id="d7">
        <label>Nº de Jovens na Classe EBD:</label><input type="number" id="d8">
        <label>Nº de Trabalhadores Local:</label><input type="number" id="d9">
        <label>Nº Jovens Matriculados:</label><input type="number" id="d10">
    </div>

    <div class="section-title">ASSINATURAS</div>

    <div class="signature-area">
        <label><strong>SECRETARIA:</strong></label>
        <div id="ts-secretaria" class="timestamp">Não assinado</div>
        <canvas id="pad-secretaria"></canvas>
        <button class="btn-clear" onclick="limpar('secretaria')">Limpar</button>
    </div>

    <div class="signature-area">
        <label><strong>ASSISTENTE DE MOCIDADE:</strong></label>
        <div id="ts-assistente" class="timestamp">Não assinado</div>
        <canvas id="pad-assistente"></canvas>
        <button class="btn-clear" onclick="limpar('assistente')">Limpar</button>
    </div>

    <div class="signature-area">
        <label><strong>DIRIGENTE DA CONGREGAÇÃO:</strong></label>
        <div id="ts-dirigente" class="timestamp">Não assinado</div>
        <canvas id="pad-dirigente"></canvas>
        <button class="btn-clear" onclick="limpar('dirigente')">Limpar</button>
    </div>

    <button class="btn-main" onclick="gerarRelatorio()">GERAR PDF E SALVAR DADOS</button>
</div>

<script>
    const { jsPDF } = window.jspdf;

    // Configuração dos quadros de assinatura
    const pads = {
        secretaria: new SignaturePad(document.getElementById('pad-secretaria')),
        assistente: new SignaturePad(document.getElementById('pad-assistente')),
        dirigente: new SignaturePad(document.getElementById('pad-dirigente'))
    };

    // Registrar hora ao tocar no canvas
    function registrarHora(id) {
        const ts = document.getElementById('ts-' + id);
        if(ts.innerText === "Não assinado") {
            ts.innerText = "Assinado em: " + new Date().toLocaleString('pt-BR');
        }
    }

    ['secretaria', 'assistente', 'dirigente'].forEach(id => {
        const canvas = document.getElementById('pad-' + id);
        canvas.addEventListener('mousedown', () => registrarHora(id));
        canvas.addEventListener('touchstart', () => registrarHora(id));
    });

    function limpar(id) {
        pads[id].clear();
        document.getElementById('ts-' + id).innerText = "Não assinado";
    }

    async function gerarRelatorio() {
        const doc = new jsPDF();
        
        // Cabeçalho PDF
        doc.setFontSize(16);
        doc.text("RELATÓRIO MENSAL DO DEPARTAMENTO DE JOVENS", 20, 20);
        
        doc.setFontSize(12);
        doc.text(`Congregação: ${document.getElementById('congregacao').value}`, 20, 35);
        doc.text(`Grupo: ${document.getElementById('grupo').value}`, 20, 42);
        doc.text(`Mês: ${document.getElementById('mes').value}`, 20, 49);

        // Dados
        let y = 65;
        const labels = ["Decisões", "Reconciliações", "Cultos Rua", "Cultos Cong.", "COJ", "Visitas", "Batismos ES", "EBD", "Trabalhadores", "Matriculados"];
        for(let i=1; i<=10; i++) {
            doc.text(`${labels[i-1]}: ${document.getElementById('d'+i).value || '0'}`, 20, y);
            y += 8;
        }

        // Adicionar Assinaturas no PDF
        if (!pads.secretaria.isEmpty()) doc.addImage(pads.secretaria.toDataURL(), 'PNG', 20, 160, 50, 20);
        doc.text("__________________", 20, 180);
        doc.text("Secretaria", 20, 185);
        doc.text(document.getElementById('ts-secretaria').innerText, 20, 190);

        // (O código completo do PDF seguiria adicionando as outras 2 assinaturas da mesma forma)

        doc.save("Relatorio_Jovens.pdf");
        
        // ENVIO PARA PLANILHA (Exemplo de log)
        console.log("Aqui enviamos os dados para o Google Sheets via API.");
        alert("PDF Gerado! Os dados foram preparados para a planilha.");
    }
</script>

</body>
</html>
